var THREE_TO_WEBGL={};THREE_TO_WEBGL[THREE.NearestFilter]=9728,THREE_TO_WEBGL[THREE.NearestMipmapNearestFilter]=9984,THREE_TO_WEBGL[THREE.NearestMipmapLinearFilter]=9986,THREE_TO_WEBGL[THREE.LinearFilter]=9729,THREE_TO_WEBGL[THREE.LinearMipmapNearestFilter]=9985,THREE_TO_WEBGL[THREE.LinearMipmapLinearFilter]=9987,THREE_TO_WEBGL[THREE.ClampToEdgeWrapping]=33071,THREE_TO_WEBGL[THREE.RepeatWrapping]=10497,THREE_TO_WEBGL[THREE.MirroredRepeatWrapping]=33648;var PATH_PROPERTIES={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(e,t,r){(r=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1},r)).animations.length>0&&(r.trs=!0);var a,n={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},s=0,i=[],o=[],l=new Map,u=[],p={},c={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},f=new Map,m=0;function h(e){return f.has(e)||f.set(e,m++),f.get(e)}function g(e,t){return e.length===t.length&&e.every((function(e,r){return e===t[r]}))}function d(e){return 4*Math.ceil(e/4)}function E(e,t){t=t||0;var r=d(e.byteLength);if(r!==e.byteLength){var a=new Uint8Array(r);if(a.set(new Uint8Array(e)),0!==t)for(var n=e.byteLength;n<r;n++)a[n]=t;return a.buffer}return e}function T(e,t){if(0!==Object.keys(e.userData).length)try{var a=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&a.gltfExtensions){for(var n in void 0===t.extensions&&(t.extensions={}),a.gltfExtensions)t.extensions[n]=a.gltfExtensions[n],p[n]=!0;delete a.gltfExtensions}Object.keys(a).length>0&&(t.extras=a)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}function v(e,t){var r=!1,a={};0===t.offset.x&&0===t.offset.y||(a.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(a.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(a.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=a,p.KHR_texture_transform=!0)}function y(e){return n.buffers||(n.buffers=[{byteLength:0}]),i.push(e),0}function b(e,t,a,i){var o;if(e.array.constructor===Float32Array)o=5126;else if(e.array.constructor===Uint32Array)o=5125;else if(e.array.constructor===Uint16Array)o=5123;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");o=5121}if(void 0===a&&(a=0),void 0===i&&(i=e.count),r.truncateDrawRange&&void 0!==t&&null===t.index){var l=a+i,u=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;a=Math.max(a,t.drawRange.start),(i=Math.min(l,u)-a)<0&&(i=0)}if(0===i)return null;var p,c=function(e,t,r){for(var a={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},n=t;n<t+r;n++)for(var s=0;s<e.itemSize;s++){var i=e.array[n*e.itemSize+s];a.min[s]=Math.min(a.min[s],i),a.max[s]=Math.max(a.max[s],i)}return a}(e,a,i);void 0!==t&&(p=e===t.index?34963:34962);var f=function(e,t,r,a,i){var o;n.bufferViews||(n.bufferViews=[]),o=5121===t?1:5123===t?2:4;for(var l=d(a*e.itemSize*o),u=new DataView(new ArrayBuffer(l)),p=0,c=r;c<r+a;c++)for(var f=0;f<e.itemSize;f++){var m=e.array[c*e.itemSize+f];5126===t?u.setFloat32(p,m,!0):5125===t?u.setUint32(p,m,!0):5123===t?u.setUint16(p,m,!0):5121===t&&u.setUint8(p,m),p+=o}var h={buffer:y(u.buffer),byteOffset:s,byteLength:l};return void 0!==i&&(h.target=i),34962===i&&(h.byteStride=e.itemSize*o),s+=l,n.bufferViews.push(h),{id:n.bufferViews.length-1,byteLength:0}}(e,o,a,i,p),m={bufferView:f.id,byteOffset:f.byteOffset,componentType:o,count:i,max:c.max,min:c.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return n.accessors||(n.accessors=[]),n.accessors.push(m),n.accessors.length-1}function w(e,t,i){c.images.has(e)||c.images.set(e,{});var l=c.images.get(e),u=t===THREE.RGBAFormat?"image/png":"image/jpeg",p=u+":flipY/"+i.toString();if(void 0!==l[p])return l[p];n.images||(n.images=[]);var f={mimeType:u};if(r.embedImages){var m=a=a||document.createElement("canvas");m.width=e.width,m.height=e.height,r.forcePowerOfTwoTextures&&!function(e){return THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)}(e)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e),m.width=THREE.Math.floorPowerOfTwo(m.width),m.height=THREE.Math.floorPowerOfTwo(m.height));var h=m.getContext("2d");!0===i&&(h.translate(0,m.height),h.scale(1,-1)),h.drawImage(e,0,0,m.width,m.height),!0===r.binary?o.push(new Promise((function(e){m.toBlob((function(t){(function(e){return n.bufferViews||(n.bufferViews=[]),new Promise((function(t){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=E(r.result),a={buffer:y(e),byteOffset:s,byteLength:e.byteLength};s+=e.byteLength,n.bufferViews.push(a),t(n.bufferViews.length-1)}}))})(t).then((function(t){f.bufferView=t,e()}))}),u)}))):f.uri=m.toDataURL(u)}else f.uri=e.src;n.images.push(f);var g=n.images.length-1;return l[p]=g,g}function R(e){n.samplers||(n.samplers=[]);var t={magFilter:THREE_TO_WEBGL[e.magFilter],minFilter:THREE_TO_WEBGL[e.minFilter],wrapS:THREE_TO_WEBGL[e.wrapS],wrapT:THREE_TO_WEBGL[e.wrapT]};return n.samplers.push(t),n.samplers.length-1}function x(e){if(c.textures.has(e))return c.textures.get(e);n.textures||(n.textures=[]);var t={sampler:R(e),source:w(e.image,e.format,e.flipY)};e.name&&(t.name=e.name),n.textures.push(t);var r=n.textures.length-1;return c.textures.set(e,r),r}function M(e){if(c.materials.has(e))return c.materials.get(e);if(n.materials||(n.materials=[]),e.isShaderMaterial&&!e.isGLTFSpecularGlossinessMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},p.KHR_materials_unlit=!0):e.isGLTFSpecularGlossinessMaterial?(t.extensions={KHR_materials_pbrSpecularGlossiness:{}},p.KHR_materials_pbrSpecularGlossiness=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(g(r,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.isGLTFSpecularGlossinessMaterial){t.pbrMetallicRoughness.baseColorFactor&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var a=[1,1,1];e.specular.toArray(a,0),t.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor=a,t.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor=e.glossiness}if(e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var s={index:x(e.metalnessMap)};v(s,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=s}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var i={index:x(e.map)};v(i,e.map),e.isGLTFSpecularGlossinessMaterial&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseTexture=i),t.pbrMetallicRoughness.baseColorTexture=i}if(e.isGLTFSpecularGlossinessMaterial&&e.specularMap){var o={index:x(e.specularMap)};v(o,e.specularMap),t.extensions.KHR_materials_pbrSpecularGlossiness.specularGlossinessTexture=o}if(e.isMeshBasicMaterial||e.isLineBasicMaterial||e.isPointsMaterial);else{var l=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(g(l,[0,0,0])||(t.emissiveFactor=l),e.emissiveMap){var u={index:x(e.emissiveMap)};v(u,e.emissiveMap),t.emissiveTexture=u}}if(e.normalMap){var f={index:x(e.normalMap)};e.normalScale&&-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),f.scale=e.normalScale.x),v(f,e.normalMap),t.normalTexture=f}if(e.aoMap){var m={index:x(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(m.strength=e.aoMapIntensity),v(m,e.aoMap),t.occlusionTexture=m}(e.transparent||e.alphaTest>0)&&(t.alphaMode=e.opacity<1?"BLEND":"MASK",e.alphaTest>0&&.5!==e.alphaTest&&(t.alphaCutoff=e.alphaTest)),e.side===THREE.DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),T(e,t),n.materials.push(t);var h=n.materials.length-1;return c.materials.set(e,h),h}function L(e,t){n.animations||(n.animations=[]);for(var r=(e=THREE.GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],s=[],i=0;i<r.length;++i){var o=r[i],u=THREE.PropertyBinding.parseTrackName(o.name),p=THREE.PropertyBinding.findNode(t,u.nodeName),c=PATH_PROPERTIES[u.propertyName];if("bones"===u.objectName&&(p=!0===p.isSkinnedMesh?p.skeleton.getBoneByName(u.objectIndex):void 0),!p||!c)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',o.name),null;var f,m=o.values.length/o.times.length;c===PATH_PROPERTIES.morphTargetInfluences&&(m/=p.morphTargetInfluences.length),!0===o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(f="CUBICSPLINE",m/=3):f=o.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",s.push({input:b(new THREE.BufferAttribute(o.times,1)),output:b(new THREE.BufferAttribute(o.values,m)),interpolation:f}),a.push({sampler:s.length-1,target:{node:l.get(p),path:c}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:s,channels:a}),n.animations.length-1}function H(e){var t=n.nodes[l.get(e)],r=e.skeleton,a=e.skeleton.bones[0];if(void 0===a)return null;for(var s=[],i=new Float32Array(16*r.bones.length),o=0;o<r.bones.length;++o)s.push(l.get(r.bones[o])),r.boneInverses[o].toArray(i,16*o);return void 0===n.skins&&(n.skins=[]),n.skins.push({inverseBindMatrices:b(new THREE.BufferAttribute(i,16)),joints:s,skeleton:l.get(a)}),t.skin=n.skins.length-1}function _(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var r=n.extensions.KHR_lights_punctual.lights;return r.push(t),r.length-1}function F(e){n.nodes||(n.nodes=[]);var t={};if(r.trs){var a=e.quaternion.toArray(),s=e.position.toArray(),i=e.scale.toArray();g(a,[0,0,0,1])||(t.rotation=a),g(s,[0,0,0])||(t.translation=s),g(i,[1,1,1])||(t.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),g(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),T(e,t),e.isMesh||e.isLine||e.isPoints){var o=function(e){var t=e.geometry.uuid+":"+e.material.uuid;if(c.meshes.has(t))return c.meshes.get(t);var a,s=e.geometry;if(e.isLineSegments)a=1;else if(e.isLineLoop)a=2;else if(e.isLine)a=3;else if(e.isPoints)a=0;else{if(!s.isBufferGeometry){console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use THREE.BufferGeometry instead.");var i=new THREE.BufferGeometry;i.fromGeometry(s),s=i}e.drawMode===THREE.TriangleFanDrawMode?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),a=6):a=e.drawMode===THREE.TriangleStripDrawMode?e.material.wireframe?3:5:e.material.wireframe?1:4}var o={},l={},u=[],p=[],f={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=s.getAttribute("normal");void 0===m||function(e){if(c.attributesNormalized.has(e))return!1;for(var t=new THREE.Vector3,r=0,a=e.count;r<a;r++)if(Math.abs(t.fromArray(e.array,3*r).length()-1)>5e-4)return!1;return!0}(m)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.addAttribute("normal",function(e){if(c.attributesNormalized.has(e))return c.attributesNormalized.get(e);for(var t=e.clone(),r=new THREE.Vector3,a=0,n=t.count;a<n;a++)r.fromArray(t.array,3*a),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),r.toArray(t.array,3*a);return c.attributesNormalized.set(e,t),t}(m)));var g=null;for(var d in s.attributes)if("morph"!==d.substr(0,5)){var E=s.attributes[d];if(d=f[d]||d.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(d)||(d="_"+d),c.attributes.has(h(E)))l[d]=c.attributes.get(h(E));else{g=null;var v=E.array;"JOINTS_0"!==d||v instanceof Uint16Array||v instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new THREE.BufferAttribute(new Uint16Array(v),E.itemSize,E.normalized));var y=b(g||E,s);null!==y&&(l[d]=y,c.attributes.set(h(E),y))}}if(void 0!==m&&s.addAttribute("normal",m),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var w=[],R=[],x={};if(void 0!==e.morphTargetDictionary)for(var L in e.morphTargetDictionary)x[e.morphTargetDictionary[L]]=L;for(var H=0;H<e.morphTargetInfluences.length;++H){var _={},F=!1;for(var d in s.morphAttributes)if("position"===d||"normal"===d){E=s.morphAttributes[d][H];var S=d.toUpperCase(),I=s.attributes[d];if(c.attributes.has(h(E)))_[S]=c.attributes.get(h(E));else{for(var A=E.clone(),G=0,O=E.count;G<O;G++)A.setXYZ(G,E.getX(G)-I.getX(G),E.getY(G)-I.getY(G),E.getZ(G)-I.getZ(G));_[S]=b(A,s),c.attributes.set(h(I),_[S])}}else F||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),F=!0);p.push(_),w.push(e.morphTargetInfluences[H]),void 0!==e.morphTargetDictionary&&R.push(x[H])}o.weights=w,R.length>0&&(o.extras={},o.extras.targetNames=R)}var B=r.forceIndices,N=Array.isArray(e.material);if(N&&0===s.groups.length)return null;!B&&null===s.index&&N&&(console.warn("THREE.GLTFExporter: Creating index for non-indexed multi-material mesh."),B=!0);var C=!1;if(null===s.index&&B){for(var U=[],P=(H=0,s.attributes.position.count);H<P;H++)U[H]=H;s.setIndex(U),C=!0}var D=N?e.material:[e.material],k=N?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(H=0,P=k.length;H<P;H++){var z={mode:a,attributes:l};T(s,z),p.length>0&&(z.targets=p),null!==s.index&&(t=h(s.index),void 0===k[H].start&&void 0===k[H].count||(t+=":"+k[H].start+":"+k[H].count),c.attributes.has(t)?z.indices=c.attributes.get(t):(z.indices=b(s.index,s,k[H].start,k[H].count),c.attributes.set(t,z.indices)),null===z.indices&&delete z.indices);var V=M(D[k[H].materialIndex]);null!==V&&(z.material=V),u.push(z)}C&&s.setIndex(null),o.primitives=u,n.meshes||(n.meshes=[]),n.meshes.push(o);var W=n.meshes.length-1;return c.meshes.set(t,W),W}(e);null!==o&&(t.mesh=o)}else if(e.isCamera)t.camera=function(e){n.cameras||(n.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:THREE.Math.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),n.cameras.push(r),n.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)p.KHR_lights_punctual||(n.extensions=n.extensions||{},n.extensions.KHR_lights_punctual={lights:[]},p.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:_(e)};else if(e.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e),null;if(e.isSkinnedMesh&&u.push(e),e.children.length>0){for(var f=[],m=0,d=e.children.length;m<d;m++){var E=e.children[m];if(E.visible||!1===r.onlyVisible){var v=F(E);null!==v&&f.push(v)}}f.length>0&&(t.children=f)}n.nodes.push(t);var y=n.nodes.length-1;return l.set(e,y),y}function S(e){n.scenes||(n.scenes=[],n.scene=0);var t={nodes:[]};""!==e.name&&(t.name=e.name),e.userData&&Object.keys(e.userData).length>0&&(t.extras=T(e)),n.scenes.push(t);for(var a=[],s=0,i=e.children.length;s<i;s++){var o=e.children[s];if(o.visible||!1===r.onlyVisible){var l=F(o);null!==l&&a.push(l)}}a.length>0&&(t.nodes=a),T(e,t)}!function(e){e=e instanceof Array?e:[e];for(var t=[],a=0;a<e.length;a++)e[a]instanceof THREE.Scene?S(e[a]):t.push(e[a]);for(t.length>0&&function(e){var t=new THREE.Scene;t.name="AuxScene";for(var r=0;r<e.length;r++)t.children.push(e[r]);S(t)}(t),a=0;a<u.length;++a)H(u[a]);for(a=0;a<r.animations.length;++a)L(r.animations[a],e[0])}(e),Promise.all(o).then((function(){var e=new Blob(i,{type:"application/octet-stream"}),a=Object.keys(p);if(a.length>0&&(n.extensionsUsed=a),n.buffers&&n.buffers.length>0){n.buffers[0].byteLength=e.size;var s=new window.FileReader;!0===r.binary?(s.readAsArrayBuffer(e),s.onloadend=function(){var e=E(s.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,e.byteLength,!0),r.setUint32(4,5130562,!0);var a=E(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),r=0,a=e.length;r<a;r++){var n=e.charCodeAt(r);t[r]=n>255?32:n}return t.buffer}(JSON.stringify(n)),32),i=new DataView(new ArrayBuffer(8));i.setUint32(0,a.byteLength,!0),i.setUint32(4,1313821514,!0);var o=new ArrayBuffer(12),l=new DataView(o);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);var u=12+i.byteLength+a.byteLength+r.byteLength+e.byteLength;l.setUint32(8,u,!0);var p=new Blob([o,i,a,r,e],{type:"application/octet-stream"}),c=new window.FileReader;c.readAsArrayBuffer(p),c.onloadend=function(){t(c.result)}}):(s.readAsDataURL(e),s.onloadend=function(){var e=s.result;n.buffers[0].uri=e,t(n)})}else t(n)}))}},THREE.GLTFExporter.Utils={insertKeyframe:function(e,t){var r,a=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),s=new e.ValueBufferType(e.values.length+a),i=e.createInterpolant(new e.ValueBufferType(a));if(0===e.times.length){n[0]=t;for(var o=0;o<a;o++)s[o]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;n[0]=t,n.set(e.times,1),s.set(i.evaluate(t),0),s.set(e.values,a),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),s.set(e.values,0),s.set(i.evaluate(t),e.values.length),r=n.length-1}else for(o=0;o<e.times.length;o++){if(Math.abs(e.times[o]-t)<.001)return o;if(e.times[o]<t&&e.times[o+1]>t){n.set(e.times.slice(0,o+1),0),n[o+1]=t,n.set(e.times.slice(o+1),o+2),s.set(e.values.slice(0,(o+1)*a),0),s.set(i.evaluate(t),(o+1)*a),s.set(e.values.slice((o+1)*a),(o+2)*a),r=o+1;break}}return e.times=n,e.values=s,r},mergeMorphTargetTracks:function(e,t){for(var r=[],a={},n=e.tracks,s=0;s<n.length;++s){var i=n[s],o=THREE.PropertyBinding.parseTrackName(i.name),l=THREE.PropertyBinding.findNode(t,o.nodeName);if("morphTargetInfluences"===o.propertyName&&void 0!==o.propertyIndex){if(i.createInterpolant!==i.InterpolantFactoryMethodDiscrete&&i.createInterpolant!==i.InterpolantFactoryMethodLinear){if(i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(i=i.clone()).setInterpolation(THREE.InterpolateLinear)}var u,p=l.morphTargetInfluences.length,c=l.morphTargetDictionary[o.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);if(void 0!==a[l.uuid]){var f=i.createInterpolant(new i.ValueBufferType(1));for(u=a[l.uuid],g=0;g<u.times.length;g++)u.values[g*p+c]=f.evaluate(u.times[g]);for(g=0;g<i.times.length;g++){var m=this.insertKeyframe(u,i.times[g]);u.values[m*p+c]=i.values[g]}}else{for(var h=new((u=i.clone()).ValueBufferType)(p*u.times.length),g=0;g<u.times.length;g++)h[g*p+c]=u.values[g];u.name=".morphTargetInfluences",u.values=h,a[l.uuid]=u,r.push(u)}}else r.push(i)}return e.tracks=r,e}};